---
title: Plotting with Pandas
jupyter:
  kernelspec:
    display_name: Python 3 (ipykernel)
    language: python
    name: python3
---



## Plotting data

- We have seen in Teaching Block 1 that `matplotlib` is the default go-to library for plotting scientific data.
- We have now been playing with `pandas` as a convenient tool to interact directly with datasets
- It is desirable to find immediate ways to do **data exploration** from pandas data structures

Today, we are precisely going to see how `pandas` data frames can be plotted, with an **expressive** and **self-contained** syntax.

## Plotting with Pandas

Pandas provides built-in plotting capabilities that make it easy to visualize data. It leverages `matplotlib` under the hood, allowing users to create plots with minimal code.

The framework is data-centric: plots are generated directly from DataFrames and Series without needing to manually extract and format data.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
import pandas as pd

data = pd.Series([10, 25, 15, 30, 20], index=['A', 'B', 'C', 'D', 'E'])
data.plot(title='Simple Line Plot')
```

## Plotting with Series

Series have a `.plot()` method that creates various types of plots. The `kind` parameter specifies the plot type: `'line'`, `'bar'`, `'barh'`, `'hist'`, `'box'`, `'pie'`, etc.

By default, the index is used for the x-axis and values for the y-axis.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
series = pd.Series([10, 25, 15, 30, 20], index=['A', 'B', 'C', 'D', 'E'])
series.plot(kind='bar', title='Bar Plot', color='skyblue')
```

## Plotting with DataFrames

DataFrames also have a `.plot()` method. By default, each column is plotted as a separate line on the same axes. The DataFrame index is used for the x-axis.

You can specify which columns to plot using the `x` and `y` parameters.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
df = pd.DataFrame({'Month': ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
    'Wheat': [2.5, 2.8, 3.2, 3.8, 4.2, 4.5],
    'Corn': [1.8, 2.1, 2.6, 3.4, 4.1, 4.8] })
df.plot(x='Month', y=['Wheat', 'Corn'], title='Crop Yields')
```

## Creating Subplots

Setting `subplots=True` creates separate plots for each column. The `layout` parameter controls the grid structure as a tuple of rows and columns.

The method returns an array of matplotlib Axes objects that can be further customized.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
df.plot(x='Month', subplots=True, layout=(1, 2), figsize=(8, 3), title='Separate Crop Plots')
```

## Time Series Plotting

Pandas automatically handles datetime formatting on the x-axis when plotting time series data. Use `pd.to_datetime()` to convert date columns to datetime objects.

The `pivot()` method can reshape data to make plotting multiple time series straightforward.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
dates = pd.date_range('2020-01', periods=12, freq='M')
ts = pd.DataFrame({'Date': dates,'Temperature': [5, 7, 12, 15, 20, 25, 28, 27, 22, 16, 10, 6]})

ts.plot(x='Date', y='Temperature', title='Monthly Temperature')
```

## Rolling Windows and Smoothing

The `.rolling()` method creates a rolling window object for computing moving averages and other aggregations. This is useful for smoothing noisy data and highlighting trends.

Chain `.mean()`, `.sum()`, or other aggregation methods after `.rolling()` to compute the result.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
#| slideshow: {slide_type: '-'}
data = pd.Series([10, 12, 13, 15, 14, 16, 18, 20, 19, 21])

ax = data.plot(label='Original', alpha=0.5)
data.rolling(window=3).mean().plot(ax=ax, label='3-Point Average', linewidth=2)
ax.legend()
```

## Saving Plots

Pandas plotting returns a matplotlib Axes object. You can save the figure by accessing the figure attribute and calling `.savefig()`, or by using `matplotlib.pyplot.savefig()` directly.

Specify file format and resolution with parameters like `dpi`.

```{pyodide}
#| caption: "▶ Ctrl/Cmd+Enter | ⇥ Ctrl/Cmd+] | ⇤ Ctrl/Cmd+["
series = pd.Series([10, 25, 15, 30, 20], index=['A', 'B', 'C', 'D', 'E'])
ax = series.plot(kind='bar', title='Example Plot')
ax.figure.savefig('my_plot.png', dpi=300, bbox_inches='tight')
```

## Today's activities:

You will find

- a **lecture** notebook with examples of plots from pandas using dummy and realistic datasets. Read through it to understand the range of capabilities.
- an **excercises** notebook working on real data from [Our world in data](https://ourworldindata.org), guiding you through a realistic visualisation pipeline

